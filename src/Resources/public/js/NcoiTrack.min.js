class NcoiTrack{constructor(a){this.$=a}track(g,a,b,c){let d=this,e=this.getDefaultUserSettings(g,a);1===g?this.setNewUserSettings(e,c):this.setUserSettings(e,b),d.makeAjax(e,a)}makeAjax(g,c){let d=this.$,f=this;d.ajax({dataType:"json",type:"POST",url:"/cookie/allowed",data:{data:g,isJava:!0},async:!1,success:function(k){if(!k.success)return void console.log(k.message);let a=k.cookieVersion;f.saveUserSettings(c,JSON.stringify({id:k.id,cookieVersion:a,cookieIds:g.cookieIds,expireTime:k.expireTime,optOut:g.optOut}));let b=Cookies.get(),l=new NcoiTemplate(d),m=k.tools,n=d("body"),h=new NcoiCookie(d);if(null!==m)m.forEach(function(c){b=h.unsetByTechnicalName(b,c.cookieToolsTechnicalName),l.addToolTemplates(c,n)});else{let a=new _NcoiAnalyticsGoogleTemplate(d);a.remove();let b=new _NcoiMatomoTemplate(d);b.remove()}let i=k.otherScripts;null!==i&&i.forEach(function(c){b=h.unsetByTechnicalName(b,c.cookieToolsTechnicalName),l.addOtherScriptTemplate(i,n)}),h.removeCookies(b)}})}getDefaultUserSettings(e,a){let b=this.$,c=b("[data-ncoi-mod-id]").data("ncoi-mod-id");return{id:null,cookieIds:[],modId:c,newConsent:e,storageKey:a,cookieVersion:0}}setNewUserSettings(a,b){let f=this.$;a.newConsent=!0,"default"===b&&(a.optOut=!0);let c=f(".ncoi---table-input");c.each(function(){let b=f(this).prop("checked");f(this).data("cookie-id")&&b&&a.cookieIds.push(f(this).data("cookie-id"))})}setUserSettings(b,c){b.optOut="modified",b.cookieIds=c.cookieIds,b.id=c.id,b.cookieVersion=c.cookieVersion}saveUserSettings(e,a){let b=this.$,c=new NcoiApp(b);c.setLocalStorage(e,a)}}
